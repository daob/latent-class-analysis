<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="DL Oberski">
<title>Latent class analysis - Local dependence LCA in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script src="site_libs/quarto-diagram/mermaid.min.js"></script><script src="site_libs/quarto-diagram/mermaid-init.js"></script><link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="styles.css">
</head>
<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Latent class analysis</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="./index.html">
 <span class="menu-text">Home</span></a>
  </li>  
</ul>
<div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Local dependence LCA in R</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Special topics</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./em-height.html" class="sidebar-item-text sidebar-link">EM: simple example</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./EM-categorical.html" class="sidebar-item-text sidebar-link">EM: categorical indicators</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./loglinear-LCA.html" class="sidebar-item-text sidebar-link">Loglinear LCA</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./local-dependence.html" class="sidebar-item-text sidebar-link active">Local dependence LCA in R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./clustering-distance.html" class="sidebar-item-text sidebar-link">Hierarchical and k-means clustering</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Applications</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./antireli.html" class="sidebar-item-text sidebar-link">Anti-religious speech</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./protest-ESS.html" class="sidebar-item-text sidebar-link">Political activism in Greece</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./project-reproduce-LCA.html" class="sidebar-item-text sidebar-link">PROJECT - Reproducing a published LCA</a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#local-dependence-in-lca" id="toc-local-dependence-in-lca" class="nav-link active" data-scroll-target="#local-dependence-in-lca">Local dependence in LCA</a>
  <ul class="collapse">
<li><a href="#example-data" id="toc-example-data" class="nav-link" data-scroll-target="#example-data">Example data</a></li>
  </ul>
</li>
  <li>
<a href="#detecting-local-dependence" id="toc-detecting-local-dependence" class="nav-link" data-scroll-target="#detecting-local-dependence">Detecting local dependence</a>
  <ul class="collapse">
<li><a href="#bivariate-residuals" id="toc-bivariate-residuals" class="nav-link" data-scroll-target="#bivariate-residuals">Bivariate residuals</a></li>
  </ul>
</li>
  <li>
<a href="#modeling-local-dependence" id="toc-modeling-local-dependence" class="nav-link" data-scroll-target="#modeling-local-dependence">Modeling local dependence</a>
  <ul class="collapse">
<li><a href="#joint-item-method" id="toc-joint-item-method" class="nav-link" data-scroll-target="#joint-item-method">Joint item method</a></li>
  <li><a href="#direct-effect-method" id="toc-direct-effect-method" class="nav-link" data-scroll-target="#direct-effect-method">Direct effect method</a></li>
  <li><a href="#loglinear-formulation" id="toc-loglinear-formulation" class="nav-link" data-scroll-target="#loglinear-formulation">Loglinear formulation</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">Local dependence LCA in R</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>DL Oberski </p>
          </div>
  </div>
    
  
    
  </div>
  

</header><section id="local-dependence-in-lca" class="level2"><h2 class="anchored" data-anchor-id="local-dependence-in-lca">Local dependence in LCA</h2>
<p>The standard latent class “cluster” model specifies that the indicators <span class="math inline">\(Y_1, Y_2, \ldots, Y_p\)</span> should be <em>conditionally independent</em>, given the latent variable <span class="math inline">\(X\)</span>, say, <span class="math display">\[
P(Y_1, Y_2, \ldots, Y_p | X) = \prod_{j = 1}^p P(Y_j | X).
\]</span> The product on the right-hand side indicates this conditional independence.</p>
<p>For example, suppose four diagnostic tests <span class="math inline">\(Y_j\)</span>, for <span class="math inline">\(j = 1, \ldots, p = 4\)</span>, have been used to test for a disease <span class="math inline">\(X \in \{0, 1\}\)</span>. Then for all people within the “healthy” class (<span class="math inline">\(X=0\)</span>, say), the four diagnostic tests should be like four independent biased coin flips, and the same should apply in the “diseased” class. This would be violated, for instance, when on diagnostic test depends on the results of another (e.g.&nbsp;the results of one are used to determine another), or when two tests use the same biological technique, thus giving similar errors. The same concern can be found in the SEM literature under the term “error correlation”.</p>
<p>Local dependence is a violation of the assumptions. Instead of the model given above, if, say, indicators <span class="math inline">\(Y_1\)</span> and <span class="math inline">\(Y_2\)</span> are locally dependent, we cannot use the simple form given on the right-hand side in that equation, and we are forced to write <span class="math display">\[
P(Y_1, Y_2, \ldots, Y_p | X) = P(Y_1, Y_2 | X) \prod_{j = 3}^p P(Y_j | X),
\]</span> so we have to have a separate model for the conditional “cross-table” <span class="math inline">\(P(Y_1, Y_2 | X)\)</span>. Ignoring this can have consequences for the solution and your subsequent conclusions. In the first, locally independent, equation above, the sensitivity (<span class="math inline">\(P(Y_j = 1 | X = 1)\)</span>) and specificity (<span class="math inline">\(P(Y_j = 0 | X = 0)\)</span>) of two indicators will look high to the model if the indicators are strongly dependent. But when this dependence was due to an error correlation, the sensitivity and specificity will be overestimated. In the extreme case, imagine including the same completely random coin flip under two different names, with two excellent indicators of the latent variable. The latent class model will then output the exact opposite of the truth: the coin flips will look reliable, while the excellent indicators will look worthless, as you can verify for yourself below.</p>
<div class="cell" data-hash="local-dependence_cache/html/unnamed-chunk-1_6729855df5cb2e2faed422aa5245405f">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>warn <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dlinzer/poLCA">poLCA</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">202302</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="local-dependence_cache/html/unnamed-chunk-2_4369ac6fd94f3b849c8909b010b336a3">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="fl">50L</span> <span class="co"># Ensure sample size is even</span></span>
<span><span class="va">sensitivity</span> <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span><span class="va">specificity</span> <span class="op">&lt;-</span> <span class="fl">0.9</span></span>
<span></span>
<span><span class="va">true_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each <span class="op">=</span> <span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="co"># Create true classes</span></span>
<span><span class="va">probs_indicators</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">specificity</span>, <span class="va">sensitivity</span><span class="op">)</span><span class="op">[</span><span class="va">true_x</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># The following is a single completely useless noise variable</span></span>
<span><span class="co"># (adding 1 is necessary because poLCA expects Y ∈ {1,2})</span></span>
<span><span class="va">garbage_coinflip</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># Here are two excellent indicators of true_x, both with Se=0.8, Sp=0.9</span></span>
<span><span class="va">great_indicator1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">probs_indicators</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="va">great_indicator2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">probs_indicators</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># The data contain two completely worthless indicators, which </span></span>
<span><span class="co">#   are completely dependent (in fact they are identical)</span></span>
<span><span class="co"># and two excellent indicators, which do have some small amount of error</span></span>
<span><span class="va">made_up_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>noise1 <span class="op">=</span> <span class="va">garbage_coinflip</span>, </span>
<span>                noise2 <span class="op">=</span> <span class="va">garbage_coinflip</span>, </span>
<span>                good1 <span class="op">=</span> <span class="va">great_indicator1</span>, </span>
<span>                good2 <span class="op">=</span> <span class="va">great_indicator2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run the latent class model using poLCA</span></span>
<span><span class="va">fit_polca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/poLCA/man/poLCA.html">poLCA</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">noise1</span>, <span class="va">noise2</span>, <span class="va">good1</span>, <span class="va">good2</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, nclass <span class="op">=</span> <span class="fl">2</span>, data <span class="op">=</span> <span class="va">made_up_data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Conditional item response (column) probabilities,
 by outcome variable, for each class (row) 
 
$noise1
          Pr(1) Pr(2)
class 1:      1     0
class 2:      0     1

$noise2
          Pr(1) Pr(2)
class 1:      1     0
class 2:      0     1

$good1
           Pr(1)  Pr(2)
class 1:  0.5000 0.5000
class 2:  0.6042 0.3958

$good2
           Pr(1)  Pr(2)
class 1:  0.5192 0.4808
class 2:  0.5417 0.4583

Estimated class population shares 
 0.52 0.48 
 
Predicted class memberships (by modal posterior prob.) 
 0.52 0.48 
 
========================================================= 
Fit for 2 latent classes: 
========================================================= 
number of observations: 100 
number of estimated parameters: 9 
residual degrees of freedom: 6 
maximum log-likelihood: -206.6095 
 
AIC(2): 431.2189
BIC(2): 454.6655
G^2(2): 44.2938 (Likelihood ratio/deviance statistic) 
X^2(2): 40.92018 (Chi-square goodness of fit) 
 </code></pre>
</div>
</div>
<div class="cell" data-hash="local-dependence_cache/html/unnamed-chunk-3_c956b69d7b7c66b44d60a2a6c451c435">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">flexmix</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice</code></pre>
</div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit_fm_ld_direct</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/flexmix/man/flexmix.html">flexmix</a></span><span class="op">(</span><span class="op">~</span><span class="fl">1</span>, data <span class="op">=</span> <span class="va">made_up_data</span><span class="op">-</span><span class="fl">1</span>, </span>
<span>          k <span class="op">=</span> <span class="fl">2</span>, </span>
<span>          model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/flexmix/man/FLXbclust.html">FLXMCmvbinary</a></span><span class="op">(</span><span class="va">noise1</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/flexmix/man/FLXglmFix.html">FLXMRglmfix</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">noise2</span>, <span class="fl">1</span><span class="op">-</span><span class="va">noise2</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, </span>
<span>                        nested <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">2</span>, formula <span class="op">=</span> <span class="op">~</span> <span class="va">noise1</span><span class="op">)</span>,</span>
<span>                        family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/flexmix/man/FLXbclust.html">FLXMCmvbinary</a></span><span class="op">(</span><span class="va">good1</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/flexmix/man/FLXbclust.html">FLXMCmvbinary</a></span><span class="op">(</span><span class="va">good2</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_fm_ld_direct</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
flexmix(formula = ~1, data = made_up_data - 1, k = 2, model = list(FLXMCmvbinary(noise1 ~ 
    1), FLXMRglmfix(formula = cbind(noise2, 1 - noise2) ~ 1, 
    nested = list(k = 2, formula = ~noise1), family = "binomial"), 
    FLXMCmvbinary(good1 ~ 1), FLXMCmvbinary(good2 ~ 1)))

       prior size post&gt;0 ratio
Comp.1  0.55   55    100  0.55
Comp.2  0.45   45    100  0.45

'log Lik.' -184.6463 (df=10)
AIC: 389.2926   BIC: 415.3443 </code></pre>
</div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">parameters</span><span class="op">(</span><span class="va">fit_fm_ld_direct</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
Comp.1.center Comp.2.center 
    0.5273048     0.4222115 

[[2]]
                    Comp.1    Comp.2
coef.noise1       53.13213  53.13213
coef.(Intercept) -26.56607 -26.56607

[[3]]
Comp.1.center Comp.2.center 
  0.003545498   0.995397964 

[[4]]
Comp.1.center Comp.2.center 
    0.1794210     0.8249772 </code></pre>
</div>
</div>
<p>As you can see, according to LCA, the locally dependent random noise items are perfect, while the very good indicators are almost worthless – exactly opposite to the truth. If you were so inclined, you could play around with the following elements to see how results might change:</p>
<ul>
<li>sensitivity and specificity values (currently <span class="math inline">\(\text{Se}=0.8\)</span>, <span class="math inline">\(\text{Sp}=0.9\)</span>);</li>
<li>number of “good” indicators (currently two);</li>
<li>number of dependent noise items (currently two);</li>
<li>the amount of local dependence (currently perfect dependence).</li>
</ul>
<p>Including an additional class can model this dependence. You can verify this by changing <code>nclass = 2</code> to <code>nclass = 3</code> above to see how results change. This may be a satisfactory solution there is no strong substantive reason to prefer a specific number of classes. For example, when mixture modeling is used as a density estimation technique, or when the analysis is exploratory. But you may not want to increase the number of classes when the latent classes are intended to have some predefined meaning, as is the case for our diagnostic testing example. In that case, we would like the two classes to signify “no disease” and “disease”, while possibly accounting for any local dependence.</p>
<section id="example-data" class="level3"><h3 class="anchored" data-anchor-id="example-data">Example data</h3>
<p>Data from Uebersax (2009), <a href="https://www.john-uebersax.com/stat/condep.htm" class="uri">https://www.john-uebersax.com/stat/condep.htm</a>. These are data on four diagnostic tests for human HIV virus (Table 1) reported by Alvord et al.&nbsp;(1988).</p>
<div class="cell" data-hash="local-dependence_cache/html/unnamed-chunk-4_0b394963a0390975c1ed39ffe08d0a57">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># https://www.john-uebersax.com/stat/condep.htm</span></span>
<span><span class="va">uebersax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_table.html">read_table</a></span><span class="op">(</span><span class="st">"../Examples/uebersax.tab"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">uebersax_01</span> <span class="op">&lt;-</span> <span class="va">uebersax</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="va">A</span><span class="op">:</span><span class="va">D</span>, <span class="va">`-`</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Freq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">Freq</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convenience function to convert frequency data to full data </span></span>
<span><span class="co">#.  by replicating rows. This is necessary because poLCA does</span></span>
<span><span class="co">#.  not handle frequency data directly.</span></span>
<span><span class="va">frequencies_to_fulldata</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df_freq</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">vnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df_freq</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df_freq</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Freq"</span><span class="op">)</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">fulldata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">df_freq</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">row</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">row</span><span class="op">[</span><span class="st">'Freq'</span><span class="op">]</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span><span class="va">row</span><span class="op">[</span><span class="st">'Freq'</span><span class="op">]</span>, <span class="va">row</span><span class="op">[</span><span class="va">vnames</span><span class="op">]</span>, simplify <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Reduce</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">as.data.frame</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">fulldata</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">vnames</span></span>
<span></span>
<span>  <span class="va">fulldata</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># A dataset in which each row is replicated Freq number of </span></span>
<span><span class="co">#   times. Doing as.data.frame(table(uebersax_fulldata)) should</span></span>
<span><span class="co">#.  give back the orginal, uebersax again</span></span>
<span><span class="va">uebersax_fulldata</span> <span class="op">&lt;-</span> <span class="fu">frequencies_to_fulldata</span><span class="op">(</span><span class="va">uebersax</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<table class="table">
<thead><tr class="header">
<th>Test</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>Radioimmunoassay of antigen ag121</td>
</tr>
<tr class="even">
<td>B</td>
<td>Radioimmunoassay of HIV p24</td>
</tr>
<tr class="odd">
<td>C</td>
<td>Radioimmunoassay of HIV gp120</td>
</tr>
<tr class="even">
<td>D</td>
<td>Enzyme-linked immunosorbent assay</td>
</tr>
</tbody>
</table>
<div class="cell" data-hash="local-dependence_cache/html/unnamed-chunk-5_d526a99694a5ebb27e20e990bb5ab5d4">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">uebersax_01</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead><tr class="header">
<th style="text-align: right;">A</th>
<th style="text-align: right;">B</th>
<th style="text-align: right;">C</th>
<th style="text-align: right;">D</th>
<th style="text-align: right;">Freq</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">170</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">15</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">17</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">83</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">128</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Fit the model using <code>poLCA</code>.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<p>
</p>
<pre class="mermaid mermaid-js" data-tooltip-selector="#mermaid-tooltip-1">flowchart TD
  X((Disease)) --&gt; A
  X --&gt; B
  X --&gt; C
  X --&gt; D
</pre>
<div id="mermaid-tooltip-1" class="mermaidTooltip">

</div>

</div>
</div>
</div>
<div class="cell" data-hash="local-dependence_cache/html/unnamed-chunk-7_32975fb79134917bde4bd12dac1f5a10">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">f_ueber</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">B</span>, <span class="va">C</span>, <span class="va">D</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span></span>
<span><span class="va">fit_ueber_polca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/poLCA/man/poLCA.html">poLCA</a></span><span class="op">(</span><span class="va">f_ueber</span>, data <span class="op">=</span> <span class="va">uebersax_fulldata</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Conditional item response (column) probabilities,
 by outcome variable, for each class (row) 
 
$A
           Pr(1)  Pr(2)
class 1:  0.0000 1.0000
class 2:  0.9703 0.0297

$B
           Pr(1)  Pr(2)
class 1:  0.4290 0.5710
class 2:  0.9644 0.0356

$C
           Pr(1)  Pr(2)
class 1:  0.0871 0.9129
class 2:  1.0000 0.0000

$D
           Pr(1)  Pr(2)
class 1:  0.0000 1.0000
class 2:  0.9195 0.0805

Estimated class population shares 
 0.5401 0.4599 
 
Predicted class memberships (by modal posterior prob.) 
 0.5421 0.4579 
 
========================================================= 
Fit for 2 latent classes: 
========================================================= 
number of observations: 428 
number of estimated parameters: 9 
residual degrees of freedom: 6 
maximum log-likelihood: -629.8827 
 
AIC(2): 1277.765
BIC(2): 1314.297
G^2(2): 16.22724 (Likelihood ratio/deviance statistic) 
X^2(2): 17.1146 (Chi-square goodness of fit) 
 </code></pre>
</div>
</div>
</section></section><section id="detecting-local-dependence" class="level2"><h2 class="anchored" data-anchor-id="detecting-local-dependence">Detecting local dependence</h2>
<section id="bivariate-residuals" class="level3"><h3 class="anchored" data-anchor-id="bivariate-residuals">Bivariate residuals</h3>
<p>We first load a few convenience functions that work with <code>poLCA</code> objects from the <code>poLCA.extras</code> package. You may need to install this using <code>remotes::install_github("daob/poLCA.extras")</code>.</p>
<div class="cell" data-hash="local-dependence_cache/html/unnamed-chunk-8_ac327ec8d0fe4b6c07ca01ad08b526d4">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># remotes::install_github("daob/poLCA.extras")</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/daob/poLCA.extras">poLCA.extras</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="local-dependence_cache/html/unnamed-chunk-9_0f83fe8d3c9e483744cbaf6dc79ecd0b">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bvr_ueber</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/poLCA.extras/man/bvr.html">bvr</a></span><span class="op">(</span><span class="va">fit_ueber_polca</span><span class="op">)</span> </span>
<span><span class="va">bvr_ueber</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       A      B      C
B 0.0243              
C 0.0026 4.0734       
D 0.0308 0.0528 0.0094</code></pre>
</div>
</div>
<p>Indicators B and C appear to exhibit local dependence. That is the same conclusion reached by Uebersax. However, the BVRs are only approximately chi-square distributed, so they cannot be directly referred to a chi-square distribution. Instead we use a parametric bootstrap. The resulting bootstrapped <span class="math inline">\(p\)</span>-values are:</p>
<div class="cell" data-hash="local-dependence_cache/html/unnamed-chunk-10_911ddbb1e9a50be959ba9d2d2df601a9">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pvals_boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/poLCA.extras/man/bootstrap_bvr_pvals.html">bootstrap_bvr_pvals</a></span><span class="op">(</span><span class="va">f_ueber</span>, </span>
<span>                                  data <span class="op">=</span> <span class="va">uebersax_fulldata</span>,</span>
<span>                                  fit_polca <span class="op">=</span> <span class="va">fit_ueber_polca</span>,</span>
<span>                                  nclass <span class="op">=</span> <span class="fl">2</span>, nrep <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pvals_boot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      A     B     C
B 0.610            
C 0.520 0.000      
D 0.265 0.560 0.240</code></pre>
</div>
</div>
<p>So, the parametric bootstrap of our BVR values confirms there appears to be a local dependence between indicators B and C.</p>
<p>Now let’s look at the bivariate residuals for our extreme earlier example, with perfect error dependence of two noise variables.</p>
<div class="cell" data-hash="local-dependence_cache/html/unnamed-chunk-11_9cc3ade3af14229e4d8b7dbf2ae40375">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/poLCA.extras/man/bvr.html">bvr</a></span><span class="op">(</span><span class="va">fit_polca</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         noise1   noise2    good1
noise2  0.00200                  
good1   0.00000  0.00000         
good2   0.00000  0.00000 40.44858</code></pre>
</div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># The bootstrap is not really necessary, and gives the </span></span>
<span><span class="co">#   expected result. If you wished to confirm this, you could </span></span>
<span><span class="co">#   uncomment the code below:</span></span>
<span><span class="co">#bootstrap_bvr_pvals(cbind(noise1, noise2, good1, good2) ~ 1, </span></span>
<span><span class="co">#                                  data = made_up_data,</span></span>
<span><span class="co">#                                  fit_polca = fit_polca,</span></span>
<span><span class="co">#                                  nclass = 2, nrep = 5)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the BVR detects local dependence, but the wrong pair of variables is singled out! This is because the latent class variable in the above, extreme, solution has taken over the role of the error dependence, while the “error dependence” is actually the substantively interesting disease status. While this is probably an extreme situation that is not particularly plausible in many applications. Still, it serves as an important warning that error dependencies found might not correspond to the “true” dependencies.</p>
</section></section><section id="modeling-local-dependence" class="level2"><h2 class="anchored" data-anchor-id="modeling-local-dependence">Modeling local dependence</h2>
<p>Now that we know:</p>
<ul>
<li>There is strong local dependence, and</li>
<li>The local dependence can make a large difference to the results;</li>
</ul>
<p>what can we do about it? As mentioned above, the simplest solution is always to increase the number of classes. But when this is not desired there are some ways of keeping the number of classes the same, but allowing for dependence within those classes.</p>
<div class="cell" data-hash="local-dependence_cache/html/unnamed-chunk-12_6e25a35213eba3853d971bafe3c61373">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">flexmix</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="joint-item-method" class="level3"><h3 class="anchored" data-anchor-id="joint-item-method">Joint item method</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<p>
</p>
<pre class="mermaid mermaid-js" data-tooltip-selector="#mermaid-tooltip-2">flowchart TD
  X((Disease)) --&gt; A
  X --&gt; BC
  X --&gt; D
</pre>
<div id="mermaid-tooltip-2" class="mermaidTooltip">

</div>

</div>
</div>
</div>
<p>First we reproduce the independence model, this time using <code>flexmix</code>.</p>
<div class="cell" data-hash="local-dependence_cache/html/unnamed-chunk-14_d7c0a027cd341ae9fe463627a93d07d6">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit_fm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flexmix/man/flexmix.html">flexmix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">B</span>, <span class="va">C</span>, <span class="va">D</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, k <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                  weights <span class="op">=</span> <span class="op">~</span><span class="va">Freq</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">uebersax_01</span>, </span>
<span>                  model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/flexmix/man/FLXbclust.html">FLXMCmvbinary</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu">parameters</span><span class="op">(</span><span class="va">fit_fm</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Comp.1 Comp.2
center.A 1.0000 0.0297
center.B 0.5710 0.0356
center.C 0.9128 0.0000
center.D 1.0000 0.0805</code></pre>
</div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">BIC</a></span><span class="op">(</span><span class="va">fit_fm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1314.298</code></pre>
</div>
</div>
<p>Next, we model the indicators B and C jointly, using a multinomial model. The same could be achieved by combining the two items into a single indicator, but here we have done that using the <code><a href="https://rdrr.io/r/base/interaction.html">interaction()</a></code> function within the model formula.</p>
<div class="cell" data-hash="local-dependence_cache/html/unnamed-chunk-15_06313f5e826cb1b34a13367e8ed4a44f">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit_fm_ld</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flexmix/man/flexmix.html">flexmix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">B</span>, <span class="va">C</span>, <span class="va">D</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, k <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                  weights <span class="op">=</span> <span class="op">~</span><span class="va">Freq</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">uebersax_01</span>, </span>
<span>                  model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/pkg/flexmix/man/FLXbclust.html">FLXMCmvbinary</a></span><span class="op">(</span><span class="va">A</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/pkg/flexmix/man/FLXMRmultinom.html">FLXMRmultinom</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html">interaction</a></span><span class="op">(</span><span class="va">B</span>, <span class="va">C</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/pkg/flexmix/man/FLXbclust.html">FLXMCmvbinary</a></span><span class="op">(</span><span class="va">D</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">parameters</span><span class="op">(</span><span class="va">fit_fm_ld</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
Comp.1.center Comp.2.center 
   0.02762408    1.00000000 

[[2]]
          Comp.1    Comp.2
coef1  -3.295787 -1.426241
coef2 -13.344558  1.610088
coef3 -13.344558  2.043280

[[3]]
Comp.1.center Comp.2.center 
   0.07853393    0.99999989 </code></pre>
</div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">BIC</a></span><span class="op">(</span><span class="va">fit_fm_ld</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1313.246</code></pre>
</div>
</div>
<p>Item conditional probabilities can still be calculated by summing over the joint crosstable.</p>
<div class="cell" data-hash="local-dependence_cache/html/unnamed-chunk-16_8c8f26f88368f53a084ad02875453d30">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">fit_fm_ld</span><span class="op">)</span></span>
<span></span>
<span><span class="va">indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">uebersax_01</span>, </span>
<span>     <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html">interaction</a></span><span class="op">(</span><span class="va">B</span>, <span class="va">C</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\\."</span>, </span>
<span>               simplify <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span></span>
<span>  B1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span><span class="op">(</span><span class="va">est</span><span class="op">$</span><span class="va">Comp.1</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">indices</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">sum</span><span class="op">)</span>,</span>
<span>  B2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span><span class="op">(</span><span class="va">est</span><span class="op">$</span><span class="va">Comp.2</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">indices</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">sum</span><span class="op">)</span>,</span>
<span>  C1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span><span class="op">(</span><span class="va">est</span><span class="op">$</span><span class="va">Comp.1</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">indices</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, <span class="va">sum</span><span class="op">)</span>,</span>
<span>  C2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span><span class="op">(</span><span class="va">est</span><span class="op">$</span><span class="va">Comp.2</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">indices</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      B1     B2 C1     C2
0 0.9643 0.4301  1 0.0888
1 0.0357 0.5699  0 0.9112</code></pre>
</div>
</div>
</section><section id="direct-effect-method" class="level3"><h3 class="anchored" data-anchor-id="direct-effect-method">Direct effect method</h3>
<p>With local dependence as a direct effect (Hagenaars), equal across classes</p>
<div class="cell">
<div class="cell-output-display">
<div>
<p>
</p>
<pre class="mermaid mermaid-js" data-tooltip-selector="#mermaid-tooltip-3">flowchart TD
  X((Disease)) --&gt; A
  X --&gt; B
  X --&gt; C
  X --&gt; D
  C --&gt; B
</pre>
<div id="mermaid-tooltip-3" class="mermaidTooltip">

</div>

</div>
</div>
</div>
<div class="cell" data-hash="local-dependence_cache/html/unnamed-chunk-18_863387c8f229479a4a401178d13112a8">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit_fm_ld_direct</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/flexmix/man/flexmix.html">flexmix</a></span><span class="op">(</span><span class="op">~</span><span class="fl">1</span>, data <span class="op">=</span> <span class="va">uebersax_01</span>, k <span class="op">=</span> <span class="fl">2</span>, </span>
<span>          weights <span class="op">=</span> <span class="op">~</span><span class="va">Freq</span>,</span>
<span>          model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/flexmix/man/FLXbclust.html">FLXMCmvbinary</a></span><span class="op">(</span><span class="va">A</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/flexmix/man/FLXglmFix.html">FLXMRglmfix</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">B</span>, <span class="fl">1</span><span class="op">-</span><span class="va">B</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, </span>
<span>                        nested <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">2</span>, formula <span class="op">=</span> <span class="op">~</span> <span class="va">C</span><span class="op">)</span>,</span>
<span>                        family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/flexmix/man/FLXbclust.html">FLXMCmvbinary</a></span><span class="op">(</span><span class="va">C</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/flexmix/man/FLXbclust.html">FLXMCmvbinary</a></span><span class="op">(</span><span class="va">D</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_fm_ld_direct</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
flexmix(formula = ~1, data = uebersax_01, k = 2, model = list(FLXMCmvbinary(A ~ 
    1), FLXMRglmfix(formula = cbind(B, 1 - B) ~ 1, nested = list(k = 2, 
    formula = ~C), family = "binomial"), FLXMCmvbinary(C ~ 1), 
    FLXMCmvbinary(D ~ 1)), weights = ~Freq)

       prior size post&gt;0 ratio
Comp.1 0.459  196    217 0.903
Comp.2 0.541  232    232 1.000

'log Lik.' -623.2972 (df=10)
AIC: 1266.594   BIC: 1307.186 </code></pre>
</div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">parameters</span><span class="op">(</span><span class="va">fit_fm_ld_direct</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">round</span>, <span class="fl">4</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
Comp.1.center Comp.2.center 
       0.0276        1.0000 

[[2]]
                  Comp.1  Comp.2
coef.C            1.8594  1.8594
coef.(Intercept) -3.2958 -1.4263

[[3]]
Comp.1.center Comp.2.center 
       0.0000        0.9112 

[[4]]
Comp.1.center Comp.2.center 
       0.0785        1.0000 </code></pre>
</div>
</div>
<p>We can again calculate a conditional probability in each class for B, this time by summing over values of C. Because the model is conditional on C, this time we weight by the marginal of C, i.e.&nbsp;<span class="math inline">\(P(B | X) = \sum_C P(B | X, C) P(C)\)</span>.</p>
<div class="cell" data-hash="local-dependence_cache/html/unnamed-chunk-19_040c11fda82ac517d96e820f477f6f10">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">P_B_given_XC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit_fm_ld_direct</span>, </span>
<span>                        newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>C<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">P_C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span><span class="op">(</span><span class="va">Freq</span><span class="op">~</span><span class="va">C</span>, data <span class="op">=</span> <span class="va">uebersax_01</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/proportions.html">prop.table</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Comp.1.avg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">P_B_given_XC</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">P_C</span><span class="op">)</span>, </span>
<span>  Comp.2.avg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">P_B_given_XC</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">P_C</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Comp.1.avg Comp.2.avg 
 0.1128125  0.3972642 </code></pre>
</div>
</div>
</section><section id="loglinear-formulation" class="level3"><h3 class="anchored" data-anchor-id="loglinear-formulation">Loglinear formulation</h3>
<p>We can use the excellent <code>cvam</code> package to create a loglinear latent class model. This allows for full flexibility, including the addition of local dependence parameters that do not require an arbitrary choice of “dependent” observed variable.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<p>
</p>
<pre class="mermaid mermaid-js" data-tooltip-selector="#mermaid-tooltip-4">flowchart TD
  X((Disease)) --&gt; A
  X --&gt; B
  X --&gt; C
  X --&gt; D
  C &lt;--&gt; B
</pre>
<div id="mermaid-tooltip-4" class="mermaidTooltip">

</div>

</div>
</div>
</div>
<p>This is probably the best solution, if you can make it work. It only tends to work for smaller examples since <code>cvam</code> has trouble with larger complete data cross-tables.</p>
<p>It works great for the small <code>uebersax</code> example.</p>
<div class="cell" data-hash="local-dependence_cache/html/unnamed-chunk-21_733d582feee3036e15fc78290489cef4">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">cvam</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"contr.sum"</span>, <span class="st">"contr.linear"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_freq</span> <span class="op">&lt;-</span> <span class="va">uebersax</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="va">as.factor</span><span class="op">)</span></span>
<span><span class="va">df_freq</span><span class="op">$</span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/cvam/man/latentFactor.html">latentFactor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">NROW</a></span><span class="op">(</span><span class="va">df_freq</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">formula</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df_freq</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df_freq</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Freq"</span>, <span class="st">"X"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>        collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"~ X * (%s)"</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">fit_cvam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/cvam/man/cvam.html">cvam</a></span><span class="op">(</span><span class="va">formula</span>, data <span class="op">=</span> <span class="va">df_freq</span>,</span>
<span>                   freq <span class="op">=</span> <span class="va">Freq</span>,</span>
<span>                   control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>startValJitter <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Note: Estimate at or near boundary
Estimated variances may be unreliable</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
  0.029   0.001   0.031 </code></pre>
</div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_cvam</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>~ X * (A + B + C + D)

Prior:
      Flattening frequency = 0
Total nuggets + flattening = 0
              Ridge factor = 0
          Intensity factor = 1

Sample size:
              total N in supplied data = 428
N from supplied data used in model fit = 428
           prior effective sample size =   0

Degrees of freedom:
    patterns of coarsened data = 16
  cells in complete-data table = 32
cells without latent variables = 16
         structural zero cells =  0
   parameters in Poisson model = 10
                            df =  6

Starting values:
default, center
jitter SD = 0.100000

EM algorithm:
Converged at iteration 17
Gradient length = 0.000002

  Final logP = 1535.422
Final loglik = 1535.422

Estimates from EM, with Hessian-based SEs
                coef       SE zstat   pval
(Intercept) -12.8057 604.0550 -0.02 0.9831
X1           -3.3879 604.0550 -0.01 0.9955
A1           -4.0673 326.4914 -0.01 0.9901
B1            0.7533   0.1018  7.40 0.0000
C1            4.3829 370.1195  0.01 0.9906
D1           -4.2866 348.2777 -0.01 0.9902
X1:A1        -5.8097 326.4914 -0.02 0.9858
X1:B1        -0.8964   0.1019 -8.80 0.0000
X1:C1        -5.5574 370.1195 -0.02 0.9880
X1:D1        -5.5040 348.2777 -0.02 0.9874</code></pre>
</div>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">what</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"~"</span>, <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="st">"|X"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">as.formula</span><span class="op">)</span></span>
<span><span class="va">est_indep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/cvam/man/cvamEstimate.html">cvamEstimate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">~</span><span class="va">X</span>, <span class="va">what</span><span class="op">)</span>, <span class="va">fit_cvam</span><span class="op">)</span></span>
<span><span class="va">est_indep</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and SE's from EM, linearized
~ X
  X   prob     SE prob.lower prob.upper
1 1 0.5401 0.0242     0.4924     0.5870
2 2 0.4599 0.0242     0.4130     0.5076
~ A | X
  X A   prob     SE prob.lower prob.upper
1 1 1 0.0000 0.0000     0.0000     1.0000
2 1 2 1.0000 0.0000     0.0000     1.0000
3 2 1 0.9703 0.0131     0.9304     0.9876
4 2 2 0.0297 0.0131     0.0124     0.0696
~ B | X
  X B   prob     SE prob.lower prob.upper
1 1 1 0.4290 0.0327     0.3665     0.4938
2 1 2 0.5710 0.0327     0.5062     0.6335
3 2 1 0.9644 0.0132     0.9272     0.9829
4 2 2 0.0356 0.0132     0.0171     0.0728
~ C | X
  X C   prob    SE prob.lower prob.upper
1 1 1 0.0871 0.019     0.0564     0.1323
2 1 2 0.9129 0.019     0.8677     0.9436
3 2 1 1.0000 0.000     0.0000     1.0000
4 2 2 0.0000 0.000     0.0000     1.0000
~ D | X
  X D   prob   SE prob.lower prob.upper
1 1 1 0.0000 0.00     0.0000     1.0000
2 1 2 1.0000 0.00     0.0000     1.0000
3 2 1 0.9195 0.02     0.8706     0.9509
4 2 2 0.0805 0.02     0.0491     0.1294</code></pre>
</div>
</div>
<p>(Note that the Hessian-based se’s cannot be trusted. We can look at the estimated se’s in the marginal probability tables above, or use <code>cvam</code>’s MCMC option to obtain standard errors on the loglinear parmeters.)</p>
<p>Now we update the model with the local dependence <span class="math inline">\(B \times C\)</span>, held equal across classes.</p>
<div class="cell" data-hash="local-dependence_cache/html/unnamed-chunk-22_4cb52e08b88388d0e6d346e9ca45cb6a">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">formula_ld</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">formula</span>, <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="va">B</span><span class="op">:</span><span class="va">C</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">fit_cvam_ld</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/cvam/man/cvam.html">cvam</a></span><span class="op">(</span><span class="va">formula_ld</span>, data <span class="op">=</span> <span class="va">df_freq</span>, freq <span class="op">=</span> <span class="va">Freq</span>,</span>
<span>         control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>startValJitter <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Note: Estimate at or near boundary
Estimated variances may be unreliable</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
  0.014   0.000   0.016 </code></pre>
</div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_cvam_ld</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>~ X + A + B + C + D + X:A + X:B + X:C + X:D + B:C

Prior:
      Flattening frequency = 0
Total nuggets + flattening = 0
              Ridge factor = 0
          Intensity factor = 1

Sample size:
              total N in supplied data = 428
N from supplied data used in model fit = 428
           prior effective sample size =   0

Degrees of freedom:
    patterns of coarsened data = 16
  cells in complete-data table = 32
cells without latent variables = 16
         structural zero cells =  0
   parameters in Poisson model = 11
                            df =  5

Starting values:
default, center
jitter SD = 0.050000

EM algorithm:
Converged at iteration 15
Gradient length = 0.000003

  Final logP = 1542.008
Final loglik = 1542.008

Estimates from EM, with Hessian-based SEs
                coef       SE zstat   pval
(Intercept) -12.6997 590.7805 -0.02 0.9828
X1            3.6793 590.7805  0.01 0.9950
A1           -4.0579 339.0420 -0.01 0.9905
B1            0.7157   0.1025  6.98 0.0000
C1            4.1125 345.8069  0.01 0.9905
D1           -4.3085 338.3633 -0.01 0.9898
X1:A1         5.8384 339.0420  0.02 0.9863
X1:B1         0.4674   0.1702  2.75 0.0060
X1:C1         5.3824 345.8069  0.02 0.9876
X1:D1         5.5397 338.3633  0.02 0.9869
B1:C1         0.4649   0.1444  3.22 0.0013</code></pre>
</div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">est_locdep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/cvam/man/cvamEstimate.html">cvamEstimate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">~</span><span class="va">X</span>, <span class="va">what</span><span class="op">)</span>, <span class="va">fit_cvam_ld</span><span class="op">)</span></span>
<span><span class="va">est_locdep</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and SE's from EM, linearized
~ X
  X   prob     SE prob.lower prob.upper
1 1 0.4589 0.0241     0.4121     0.5065
2 2 0.5411 0.0241     0.4935     0.5879
~ A | X
  X A   prob     SE prob.lower prob.upper
1 1 1 0.9724 0.0122     0.9354     0.9885
2 1 2 0.0276 0.0122     0.0115     0.0646
3 2 1 0.0000 0.0000     0.0000     1.0000
4 2 2 1.0000 0.0000     0.0000     1.0000
~ B | X
  X B   prob     SE prob.lower prob.upper
1 1 1 0.9643 0.0133     0.9270     0.9829
2 1 2 0.0357 0.0133     0.0171     0.0730
3 2 1 0.4301 0.0326     0.3677     0.4947
4 2 2 0.5699 0.0326     0.5053     0.6323
~ C | X
  X C   prob     SE prob.lower prob.upper
1 1 1 1.0000 0.0000     0.0000     1.0000
2 1 2 0.0000 0.0000     0.0000     1.0000
3 2 1 0.0888 0.0189     0.0581     0.1335
4 2 2 0.9112 0.0189     0.8665     0.9419
~ D | X
  X D   prob     SE prob.lower prob.upper
1 1 1 0.9215 0.0195     0.8738     0.9521
2 1 2 0.0785 0.0195     0.0479     0.1262
3 2 1 0.0000 0.0000     0.0000     1.0000
4 2 2 1.0000 0.0000     0.0000     1.0000</code></pre>
</div>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">fit_cvam</span>, <span class="va">fit_cvam_ld</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model 1: ~ X * (A + B + C + D)
Model 2: ~ X + A + B + C + D + X:A + X:B + X:C + X:D + B:C
  resid.df -2*loglik df change
1        6   -3070.8          
2        5   -3084.0  1 13.171</code></pre>
</div>
</div>
<p>The local dependence model fits better, but the estimated (conditional) probabilities do not change much.</p>


<!-- -->

</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb55" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Local dependence LCA in R"</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "DL Oberski"</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Show the code"</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-link: true</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: zephyr</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="co">  cache: true</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a><span class="fu">## Local dependence in LCA</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>The standard latent class "cluster" model specifies that the indicators $Y_1, Y_2, \ldots, Y_p$ should be *conditionally independent*, given the latent variable $X$, say, $$</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>P(Y_1, Y_2, \ldots, Y_p | X) = \prod_{j = 1}^p P(Y_j | X).</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>$$ The product on the right-hand side indicates this conditional independence.</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>For example, suppose four diagnostic tests $Y_j$, for $j = 1, \ldots, p = 4$, have been used to test for a disease $X \in <span class="sc">\{</span>0, 1<span class="sc">\}</span>$. Then for all people within the "healthy" class ($X=0$, say), the four diagnostic tests should be like four independent biased coin flips, and the same should apply in the "diseased" class. This would be violated, for instance, when on diagnostic test depends on the results of another (e.g. the results of one are used to determine another), or when two tests use the same biological technique, thus giving similar errors. The same concern can be found in the SEM literature under the term "error correlation".</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>Local dependence is a violation of the assumptions. Instead of the model given above, if, say, indicators $Y_1$ and $Y_2$ are locally dependent, we cannot use the simple form given on the right-hand side in that equation, and we are forced to write $$</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>P(Y_1, Y_2, \ldots, Y_p | X) = P(Y_1, Y_2 | X) \prod_{j = 3}^p P(Y_j | X),</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>$$ so we have to have a separate model for the conditional "cross-table" $P(Y_1, Y_2 | X)$. Ignoring this can have consequences for the solution and your subsequent conclusions. In the first, locally independent, equation above, the sensitivity ($P(Y_j = 1 | X = 1)$) and specificity ($P(Y_j = 0 | X = 0)$) of two indicators will look high to the model if the indicators are strongly dependent. But when this dependence was due to an error correlation, the sensitivity and specificity will be overestimated. In the extreme case, imagine including the same completely random coin flip under two different names, with two excellent indicators of the latent variable. The latent class model will then output the exact opposite of the truth: the coin flips will look reliable, while the excellent indicators will look worthless, as you can verify for yourself below.</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">warn =</span> <span class="dv">1</span>)</span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(poLCA)</span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">202302</span>)</span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>50L <span class="co"># Ensure sample size is even</span></span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">&lt;-</span> <span class="fl">0.9</span></span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a>true_x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">each =</span> n<span class="sc">/</span><span class="dv">2</span>) <span class="co"># Create true classes</span></span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a>probs_indicators <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span> <span class="sc">-</span> specificity, sensitivity)[true_x]</span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a><span class="co"># The following is a single completely useless noise variable</span></span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a><span class="co"># (adding 1 is necessary because poLCA expects Y ∈ {1,2})</span></span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a>garbage_coinflip <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.5</span>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb55-51"><a href="#cb55-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-52"><a href="#cb55-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Here are two excellent indicators of true_x, both with Se=0.8, Sp=0.9</span></span>
<span id="cb55-53"><a href="#cb55-53" aria-hidden="true" tabindex="-1"></a>great_indicator1 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="at">prob =</span> probs_indicators) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb55-54"><a href="#cb55-54" aria-hidden="true" tabindex="-1"></a>great_indicator2 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="at">prob =</span> probs_indicators) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb55-55"><a href="#cb55-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-56"><a href="#cb55-56" aria-hidden="true" tabindex="-1"></a><span class="co"># The data contain two completely worthless indicators, which </span></span>
<span id="cb55-57"><a href="#cb55-57" aria-hidden="true" tabindex="-1"></a><span class="co">#   are completely dependent (in fact they are identical)</span></span>
<span id="cb55-58"><a href="#cb55-58" aria-hidden="true" tabindex="-1"></a><span class="co"># and two excellent indicators, which do have some small amount of error</span></span>
<span id="cb55-59"><a href="#cb55-59" aria-hidden="true" tabindex="-1"></a>made_up_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">noise1 =</span> garbage_coinflip, </span>
<span id="cb55-60"><a href="#cb55-60" aria-hidden="true" tabindex="-1"></a>                <span class="at">noise2 =</span> garbage_coinflip, </span>
<span id="cb55-61"><a href="#cb55-61" aria-hidden="true" tabindex="-1"></a>                <span class="at">good1 =</span> great_indicator1, </span>
<span id="cb55-62"><a href="#cb55-62" aria-hidden="true" tabindex="-1"></a>                <span class="at">good2 =</span> great_indicator2)</span>
<span id="cb55-63"><a href="#cb55-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-64"><a href="#cb55-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the latent class model using poLCA</span></span>
<span id="cb55-65"><a href="#cb55-65" aria-hidden="true" tabindex="-1"></a>fit_polca <span class="ot">&lt;-</span> <span class="fu">poLCA</span>(<span class="fu">cbind</span>(noise1, noise2, good1, good2) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">nclass =</span> <span class="dv">2</span>, <span class="at">data =</span> made_up_data)</span>
<span id="cb55-66"><a href="#cb55-66" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-67"><a href="#cb55-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-70"><a href="#cb55-70" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-71"><a href="#cb55-71" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flexmix)</span>
<span id="cb55-72"><a href="#cb55-72" aria-hidden="true" tabindex="-1"></a>fit_fm_ld_direct <span class="ot">&lt;-</span> </span>
<span id="cb55-73"><a href="#cb55-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flexmix</span>(<span class="sc">~</span><span class="dv">1</span>, <span class="at">data =</span> made_up_data<span class="dv">-1</span>, </span>
<span id="cb55-74"><a href="#cb55-74" aria-hidden="true" tabindex="-1"></a>          <span class="at">k =</span> <span class="dv">2</span>, </span>
<span id="cb55-75"><a href="#cb55-75" aria-hidden="true" tabindex="-1"></a>          <span class="at">model =</span> <span class="fu">list</span>(</span>
<span id="cb55-76"><a href="#cb55-76" aria-hidden="true" tabindex="-1"></a>            <span class="fu">FLXMCmvbinary</span>(noise1 <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb55-77"><a href="#cb55-77" aria-hidden="true" tabindex="-1"></a>            <span class="fu">FLXMRglmfix</span>(<span class="at">formula =</span> <span class="fu">cbind</span>(noise2, <span class="dv">1</span><span class="sc">-</span>noise2) <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb55-78"><a href="#cb55-78" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nested =</span> <span class="fu">list</span>(<span class="at">k =</span> <span class="dv">2</span>, <span class="at">formula =</span> <span class="sc">~</span> noise1),</span>
<span id="cb55-79"><a href="#cb55-79" aria-hidden="true" tabindex="-1"></a>                        <span class="at">family =</span> <span class="st">"binomial"</span>), </span>
<span id="cb55-80"><a href="#cb55-80" aria-hidden="true" tabindex="-1"></a>            <span class="fu">FLXMCmvbinary</span>(good1 <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb55-81"><a href="#cb55-81" aria-hidden="true" tabindex="-1"></a>            <span class="fu">FLXMCmvbinary</span>(good2 <span class="sc">~</span> <span class="dv">1</span>)))</span>
<span id="cb55-82"><a href="#cb55-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-83"><a href="#cb55-83" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_fm_ld_direct)</span>
<span id="cb55-84"><a href="#cb55-84" aria-hidden="true" tabindex="-1"></a><span class="fu">parameters</span>(fit_fm_ld_direct)</span>
<span id="cb55-85"><a href="#cb55-85" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-86"><a href="#cb55-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-87"><a href="#cb55-87" aria-hidden="true" tabindex="-1"></a>As you can see, according to LCA, the locally dependent random noise items are perfect, while the very good indicators are almost worthless -- exactly opposite to the truth. If you were so inclined, you could play around with the following elements to see how results might change:</span>
<span id="cb55-88"><a href="#cb55-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-89"><a href="#cb55-89" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>sensitivity and specificity values (currently $\text{Se}=<span class="in">`r sensitivity`</span>$, $\text{Sp}=<span class="in">`r specificity`</span>$);</span>
<span id="cb55-90"><a href="#cb55-90" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>number of "good" indicators (currently two);</span>
<span id="cb55-91"><a href="#cb55-91" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>number of dependent noise items (currently two);</span>
<span id="cb55-92"><a href="#cb55-92" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>the amount of local dependence (currently perfect dependence).</span>
<span id="cb55-93"><a href="#cb55-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-94"><a href="#cb55-94" aria-hidden="true" tabindex="-1"></a>Including an additional class can model this dependence. You can verify this by changing <span class="in">`nclass = 2`</span> to <span class="in">`nclass = 3`</span> above to see how results change. This may be a satisfactory solution there is no strong substantive reason to prefer a specific number of classes. For example, when mixture modeling is used as a density estimation technique, or when the analysis is exploratory. But you may not want to increase the number of classes when the latent classes are intended to have some predefined meaning, as is the case for our diagnostic testing example. In that case, we would like the two classes to signify "no disease" and "disease", while possibly accounting for any local dependence.</span>
<span id="cb55-95"><a href="#cb55-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-96"><a href="#cb55-96" aria-hidden="true" tabindex="-1"></a><span class="fu">### Example data</span></span>
<span id="cb55-97"><a href="#cb55-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-98"><a href="#cb55-98" aria-hidden="true" tabindex="-1"></a>Data from Uebersax (2009), <span class="ot">&lt;https://www.john-uebersax.com/stat/condep.htm&gt;</span>. These are data on four diagnostic tests for human HIV virus (Table 1) reported by Alvord et al. (1988).</span>
<span id="cb55-99"><a href="#cb55-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-102"><a href="#cb55-102" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-103"><a href="#cb55-103" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb55-104"><a href="#cb55-104" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb55-105"><a href="#cb55-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-106"><a href="#cb55-106" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.john-uebersax.com/stat/condep.htm</span></span>
<span id="cb55-107"><a href="#cb55-107" aria-hidden="true" tabindex="-1"></a>uebersax <span class="ot">&lt;-</span> <span class="fu">read_table</span>(<span class="st">"../Examples/uebersax.tab"</span>)</span>
<span id="cb55-108"><a href="#cb55-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-109"><a href="#cb55-109" aria-hidden="true" tabindex="-1"></a>uebersax_01 <span class="ot">&lt;-</span> uebersax <span class="sc">%&gt;%</span> </span>
<span id="cb55-110"><a href="#cb55-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(A<span class="sc">:</span>D, <span class="st">`</span><span class="at">-</span><span class="st">`</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-111"><a href="#cb55-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Freq =</span> <span class="fu">as.integer</span>(Freq))</span>
<span id="cb55-112"><a href="#cb55-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-113"><a href="#cb55-113" aria-hidden="true" tabindex="-1"></a><span class="co"># Convenience function to convert frequency data to full data </span></span>
<span id="cb55-114"><a href="#cb55-114" aria-hidden="true" tabindex="-1"></a><span class="co">#.  by replicating rows. This is necessary because poLCA does</span></span>
<span id="cb55-115"><a href="#cb55-115" aria-hidden="true" tabindex="-1"></a><span class="co">#.  not handle frequency data directly.</span></span>
<span id="cb55-116"><a href="#cb55-116" aria-hidden="true" tabindex="-1"></a>frequencies_to_fulldata <span class="ot">&lt;-</span> <span class="cf">function</span>(df_freq) {</span>
<span id="cb55-117"><a href="#cb55-117" aria-hidden="true" tabindex="-1"></a>  vnames <span class="ot">&lt;-</span> <span class="fu">names</span>(df_freq)[<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(df_freq) <span class="sc">==</span> <span class="st">"Freq"</span>)]</span>
<span id="cb55-118"><a href="#cb55-118" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-119"><a href="#cb55-119" aria-hidden="true" tabindex="-1"></a>  fulldata <span class="ot">&lt;-</span> <span class="fu">apply</span>(df_freq, <span class="dv">1</span>, <span class="cf">function</span>(row) {</span>
<span id="cb55-120"><a href="#cb55-120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(row[<span class="st">'Freq'</span>] <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb55-121"><a href="#cb55-121" aria-hidden="true" tabindex="-1"></a>      <span class="fu">t</span>(<span class="fu">replicate</span>(row[<span class="st">'Freq'</span>], row[vnames], <span class="at">simplify =</span> <span class="cn">TRUE</span>))</span>
<span id="cb55-122"><a href="#cb55-122" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">%&gt;%</span> <span class="fu">Reduce</span>(rbind, .) <span class="sc">%&gt;%</span> as.data.frame</span>
<span id="cb55-123"><a href="#cb55-123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-124"><a href="#cb55-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(fulldata) <span class="ot">&lt;-</span> vnames</span>
<span id="cb55-125"><a href="#cb55-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-126"><a href="#cb55-126" aria-hidden="true" tabindex="-1"></a>  fulldata</span>
<span id="cb55-127"><a href="#cb55-127" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-128"><a href="#cb55-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-129"><a href="#cb55-129" aria-hidden="true" tabindex="-1"></a><span class="co"># A dataset in which each row is replicated Freq number of </span></span>
<span id="cb55-130"><a href="#cb55-130" aria-hidden="true" tabindex="-1"></a><span class="co">#   times. Doing as.data.frame(table(uebersax_fulldata)) should</span></span>
<span id="cb55-131"><a href="#cb55-131" aria-hidden="true" tabindex="-1"></a><span class="co">#.  give back the orginal, uebersax again</span></span>
<span id="cb55-132"><a href="#cb55-132" aria-hidden="true" tabindex="-1"></a>uebersax_fulldata <span class="ot">&lt;-</span> <span class="fu">frequencies_to_fulldata</span>(uebersax)</span>
<span id="cb55-133"><a href="#cb55-133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-134"><a href="#cb55-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-135"><a href="#cb55-135" aria-hidden="true" tabindex="-1"></a>| Test | Description                       |</span>
<span id="cb55-136"><a href="#cb55-136" aria-hidden="true" tabindex="-1"></a>|------|-----------------------------------|</span>
<span id="cb55-137"><a href="#cb55-137" aria-hidden="true" tabindex="-1"></a>| A    | Radioimmunoassay of antigen ag121 |</span>
<span id="cb55-138"><a href="#cb55-138" aria-hidden="true" tabindex="-1"></a>| B    | Radioimmunoassay of HIV p24       |</span>
<span id="cb55-139"><a href="#cb55-139" aria-hidden="true" tabindex="-1"></a>| C    | Radioimmunoassay of HIV gp120     |</span>
<span id="cb55-140"><a href="#cb55-140" aria-hidden="true" tabindex="-1"></a>| D    | Enzyme-linked immunosorbent assay |</span>
<span id="cb55-141"><a href="#cb55-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-144"><a href="#cb55-144" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-145"><a href="#cb55-145" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb55-146"><a href="#cb55-146" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(uebersax_01)</span>
<span id="cb55-147"><a href="#cb55-147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-148"><a href="#cb55-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-149"><a href="#cb55-149" aria-hidden="true" tabindex="-1"></a>Fit the model using <span class="in">`poLCA`</span>.</span>
<span id="cb55-150"><a href="#cb55-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-153"><a href="#cb55-153" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb55-154"><a href="#cb55-154" aria-hidden="true" tabindex="-1"></a>flowchart TD</span>
<span id="cb55-155"><a href="#cb55-155" aria-hidden="true" tabindex="-1"></a>  X((Disease)) --&gt; A</span>
<span id="cb55-156"><a href="#cb55-156" aria-hidden="true" tabindex="-1"></a>  X --&gt; B</span>
<span id="cb55-157"><a href="#cb55-157" aria-hidden="true" tabindex="-1"></a>  X --&gt; C</span>
<span id="cb55-158"><a href="#cb55-158" aria-hidden="true" tabindex="-1"></a>  X --&gt; D</span>
<span id="cb55-159"><a href="#cb55-159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-160"><a href="#cb55-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-163"><a href="#cb55-163" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-164"><a href="#cb55-164" aria-hidden="true" tabindex="-1"></a>f_ueber <span class="ot">&lt;-</span> <span class="fu">cbind</span>(A, B, C, D) <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb55-165"><a href="#cb55-165" aria-hidden="true" tabindex="-1"></a>fit_ueber_polca <span class="ot">&lt;-</span> <span class="fu">poLCA</span>(f_ueber, <span class="at">data =</span> uebersax_fulldata)</span>
<span id="cb55-166"><a href="#cb55-166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-167"><a href="#cb55-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-168"><a href="#cb55-168" aria-hidden="true" tabindex="-1"></a><span class="fu">## Detecting local dependence</span></span>
<span id="cb55-169"><a href="#cb55-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-170"><a href="#cb55-170" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bivariate residuals</span></span>
<span id="cb55-171"><a href="#cb55-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-172"><a href="#cb55-172" aria-hidden="true" tabindex="-1"></a>We first load a few convenience functions that work with <span class="in">`poLCA`</span> objects from the <span class="in">`poLCA.extras`</span> package. You may need to install this using <span class="in">`remotes::install_github("daob/poLCA.extras")`</span>.</span>
<span id="cb55-173"><a href="#cb55-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-176"><a href="#cb55-176" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-177"><a href="#cb55-177" aria-hidden="true" tabindex="-1"></a><span class="co"># remotes::install_github("daob/poLCA.extras")</span></span>
<span id="cb55-178"><a href="#cb55-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-179"><a href="#cb55-179" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(poLCA.extras)</span>
<span id="cb55-180"><a href="#cb55-180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-181"><a href="#cb55-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-184"><a href="#cb55-184" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-185"><a href="#cb55-185" aria-hidden="true" tabindex="-1"></a>bvr_ueber <span class="ot">&lt;-</span> <span class="fu">bvr</span>(fit_ueber_polca) </span>
<span id="cb55-186"><a href="#cb55-186" aria-hidden="true" tabindex="-1"></a>bvr_ueber <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">4</span>) </span>
<span id="cb55-187"><a href="#cb55-187" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-188"><a href="#cb55-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-189"><a href="#cb55-189" aria-hidden="true" tabindex="-1"></a>Indicators B and C appear to exhibit local dependence. That is the same conclusion reached by Uebersax. However, the BVRs are only approximately chi-square distributed, so they cannot be directly referred to a chi-square distribution. Instead we use a parametric bootstrap. The resulting bootstrapped $p$-values are:</span>
<span id="cb55-190"><a href="#cb55-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-193"><a href="#cb55-193" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-194"><a href="#cb55-194" aria-hidden="true" tabindex="-1"></a>pvals_boot <span class="ot">&lt;-</span> <span class="fu">bootstrap_bvr_pvals</span>(f_ueber, </span>
<span id="cb55-195"><a href="#cb55-195" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">data =</span> uebersax_fulldata,</span>
<span id="cb55-196"><a href="#cb55-196" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">fit_polca =</span> fit_ueber_polca,</span>
<span id="cb55-197"><a href="#cb55-197" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">nclass =</span> <span class="dv">2</span>, <span class="at">nrep =</span> <span class="dv">3</span>)</span>
<span id="cb55-198"><a href="#cb55-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-199"><a href="#cb55-199" aria-hidden="true" tabindex="-1"></a>pvals_boot</span>
<span id="cb55-200"><a href="#cb55-200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-201"><a href="#cb55-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-202"><a href="#cb55-202" aria-hidden="true" tabindex="-1"></a>So, the parametric bootstrap of our BVR values confirms there appears to be a local dependence between indicators B and C.</span>
<span id="cb55-203"><a href="#cb55-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-204"><a href="#cb55-204" aria-hidden="true" tabindex="-1"></a>Now let's look at the bivariate residuals for our extreme earlier example, with perfect error dependence of two noise variables.</span>
<span id="cb55-205"><a href="#cb55-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-208"><a href="#cb55-208" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-209"><a href="#cb55-209" aria-hidden="true" tabindex="-1"></a><span class="fu">bvr</span>(fit_polca)</span>
<span id="cb55-210"><a href="#cb55-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-211"><a href="#cb55-211" aria-hidden="true" tabindex="-1"></a><span class="co"># The bootstrap is not really necessary, and gives the </span></span>
<span id="cb55-212"><a href="#cb55-212" aria-hidden="true" tabindex="-1"></a><span class="co">#   expected result. If you wished to confirm this, you could </span></span>
<span id="cb55-213"><a href="#cb55-213" aria-hidden="true" tabindex="-1"></a><span class="co">#   uncomment the code below:</span></span>
<span id="cb55-214"><a href="#cb55-214" aria-hidden="true" tabindex="-1"></a><span class="co">#bootstrap_bvr_pvals(cbind(noise1, noise2, good1, good2) ~ 1, </span></span>
<span id="cb55-215"><a href="#cb55-215" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  data = made_up_data,</span></span>
<span id="cb55-216"><a href="#cb55-216" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  fit_polca = fit_polca,</span></span>
<span id="cb55-217"><a href="#cb55-217" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  nclass = 2, nrep = 5)</span></span>
<span id="cb55-218"><a href="#cb55-218" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-219"><a href="#cb55-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-220"><a href="#cb55-220" aria-hidden="true" tabindex="-1"></a>Note that the BVR detects local dependence, but the wrong pair of variables is singled out! This is because the latent class variable in the above, extreme, solution has taken over the role of the error dependence, while the "error dependence" is actually the substantively interesting disease status. While this is probably an extreme situation that is not particularly plausible in many applications. Still, it serves as an important warning that error dependencies found might not correspond to the "true" dependencies.</span>
<span id="cb55-221"><a href="#cb55-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-222"><a href="#cb55-222" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modeling local dependence</span></span>
<span id="cb55-223"><a href="#cb55-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-224"><a href="#cb55-224" aria-hidden="true" tabindex="-1"></a>Now that we know:</span>
<span id="cb55-225"><a href="#cb55-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-226"><a href="#cb55-226" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>There is strong local dependence, and</span>
<span id="cb55-227"><a href="#cb55-227" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The local dependence can make a large difference to the results;</span>
<span id="cb55-228"><a href="#cb55-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-229"><a href="#cb55-229" aria-hidden="true" tabindex="-1"></a>what can we do about it? As mentioned above, the simplest solution is always to increase the number of classes. But when this is not desired there are some ways of keeping the number of classes the same, but allowing for dependence within those classes.</span>
<span id="cb55-230"><a href="#cb55-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-233"><a href="#cb55-233" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-234"><a href="#cb55-234" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb55-235"><a href="#cb55-235" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flexmix)</span>
<span id="cb55-236"><a href="#cb55-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-237"><a href="#cb55-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-238"><a href="#cb55-238" aria-hidden="true" tabindex="-1"></a><span class="fu">### Joint item method</span></span>
<span id="cb55-239"><a href="#cb55-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-242"><a href="#cb55-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb55-243"><a href="#cb55-243" aria-hidden="true" tabindex="-1"></a>flowchart TD</span>
<span id="cb55-244"><a href="#cb55-244" aria-hidden="true" tabindex="-1"></a>  X((Disease)) --&gt; A</span>
<span id="cb55-245"><a href="#cb55-245" aria-hidden="true" tabindex="-1"></a>  X --&gt; BC</span>
<span id="cb55-246"><a href="#cb55-246" aria-hidden="true" tabindex="-1"></a>  X --&gt; D</span>
<span id="cb55-247"><a href="#cb55-247" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-248"><a href="#cb55-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-249"><a href="#cb55-249" aria-hidden="true" tabindex="-1"></a>First we reproduce the independence model, this time using <span class="in">`flexmix`</span>.</span>
<span id="cb55-250"><a href="#cb55-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-253"><a href="#cb55-253" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-254"><a href="#cb55-254" aria-hidden="true" tabindex="-1"></a>fit_fm <span class="ot">&lt;-</span> <span class="fu">flexmix</span>(<span class="fu">cbind</span>(A, B, C, D) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">k =</span> <span class="dv">2</span>, </span>
<span id="cb55-255"><a href="#cb55-255" aria-hidden="true" tabindex="-1"></a>                  <span class="at">weights =</span> <span class="sc">~</span>Freq,</span>
<span id="cb55-256"><a href="#cb55-256" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> uebersax_01, </span>
<span id="cb55-257"><a href="#cb55-257" aria-hidden="true" tabindex="-1"></a>                  <span class="at">model =</span> <span class="fu">FLXMCmvbinary</span>())</span>
<span id="cb55-258"><a href="#cb55-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-259"><a href="#cb55-259" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">parameters</span>(fit_fm), <span class="dv">4</span>)</span>
<span id="cb55-260"><a href="#cb55-260" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(fit_fm)</span>
<span id="cb55-261"><a href="#cb55-261" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-262"><a href="#cb55-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-263"><a href="#cb55-263" aria-hidden="true" tabindex="-1"></a>Next, we model the indicators B and C jointly, using a multinomial model. The same could be achieved by combining the two items into a single indicator, but here we have done that using the <span class="in">`interaction()`</span> function within the model formula.</span>
<span id="cb55-264"><a href="#cb55-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-267"><a href="#cb55-267" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-268"><a href="#cb55-268" aria-hidden="true" tabindex="-1"></a>fit_fm_ld <span class="ot">&lt;-</span> <span class="fu">flexmix</span>(<span class="fu">cbind</span>(A, B, C, D) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">k =</span> <span class="dv">2</span>, </span>
<span id="cb55-269"><a href="#cb55-269" aria-hidden="true" tabindex="-1"></a>                  <span class="at">weights =</span> <span class="sc">~</span>Freq,</span>
<span id="cb55-270"><a href="#cb55-270" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> uebersax_01, </span>
<span id="cb55-271"><a href="#cb55-271" aria-hidden="true" tabindex="-1"></a>                  <span class="at">model =</span> <span class="fu">list</span>(</span>
<span id="cb55-272"><a href="#cb55-272" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">FLXMCmvbinary</span>(A <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb55-273"><a href="#cb55-273" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">FLXMRmultinom</span>(<span class="fu">I</span>(<span class="fu">interaction</span>(B, C)) <span class="sc">~</span> .),</span>
<span id="cb55-274"><a href="#cb55-274" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">FLXMCmvbinary</span>(D <span class="sc">~</span> <span class="dv">1</span>))</span>
<span id="cb55-275"><a href="#cb55-275" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-276"><a href="#cb55-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-277"><a href="#cb55-277" aria-hidden="true" tabindex="-1"></a><span class="fu">parameters</span>(fit_fm_ld)</span>
<span id="cb55-278"><a href="#cb55-278" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(fit_fm_ld)</span>
<span id="cb55-279"><a href="#cb55-279" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-280"><a href="#cb55-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-281"><a href="#cb55-281" aria-hidden="true" tabindex="-1"></a>Item conditional probabilities can still be calculated by summing over the joint crosstable.</span>
<span id="cb55-282"><a href="#cb55-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-285"><a href="#cb55-285" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-286"><a href="#cb55-286" aria-hidden="true" tabindex="-1"></a>est <span class="ot">&lt;-</span> <span class="fu">fitted</span>(fit_fm_ld)</span>
<span id="cb55-287"><a href="#cb55-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-288"><a href="#cb55-288" aria-hidden="true" tabindex="-1"></a>indices <span class="ot">&lt;-</span> <span class="fu">with</span>(uebersax_01, </span>
<span id="cb55-289"><a href="#cb55-289" aria-hidden="true" tabindex="-1"></a>     <span class="fu">str_split</span>(<span class="fu">levels</span>(<span class="fu">interaction</span>(B, C)), <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, </span>
<span id="cb55-290"><a href="#cb55-290" aria-hidden="true" tabindex="-1"></a>               <span class="at">simplify =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb55-291"><a href="#cb55-291" aria-hidden="true" tabindex="-1"></a>       <span class="fu">apply</span>(<span class="dv">2</span>, as.numeric))</span>
<span id="cb55-292"><a href="#cb55-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-293"><a href="#cb55-293" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(</span>
<span id="cb55-294"><a href="#cb55-294" aria-hidden="true" tabindex="-1"></a>  <span class="at">B1 =</span> <span class="fu">tapply</span>(est<span class="sc">$</span>Comp<span class="fl">.1</span>[<span class="dv">1</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>], indices[, <span class="dv">1</span>], sum),</span>
<span id="cb55-295"><a href="#cb55-295" aria-hidden="true" tabindex="-1"></a>  <span class="at">B2 =</span> <span class="fu">tapply</span>(est<span class="sc">$</span>Comp<span class="fl">.2</span>[<span class="dv">1</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>], indices[, <span class="dv">1</span>], sum),</span>
<span id="cb55-296"><a href="#cb55-296" aria-hidden="true" tabindex="-1"></a>  <span class="at">C1 =</span> <span class="fu">tapply</span>(est<span class="sc">$</span>Comp<span class="fl">.1</span>[<span class="dv">1</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>], indices[, <span class="dv">2</span>], sum),</span>
<span id="cb55-297"><a href="#cb55-297" aria-hidden="true" tabindex="-1"></a>  <span class="at">C2 =</span> <span class="fu">tapply</span>(est<span class="sc">$</span>Comp<span class="fl">.2</span>[<span class="dv">1</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>], indices[, <span class="dv">2</span>], sum)</span>
<span id="cb55-298"><a href="#cb55-298" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">4</span>)</span>
<span id="cb55-299"><a href="#cb55-299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-300"><a href="#cb55-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-301"><a href="#cb55-301" aria-hidden="true" tabindex="-1"></a><span class="fu">### Direct effect method</span></span>
<span id="cb55-302"><a href="#cb55-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-303"><a href="#cb55-303" aria-hidden="true" tabindex="-1"></a>With local dependence as a direct effect (Hagenaars), equal across classes</span>
<span id="cb55-304"><a href="#cb55-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-307"><a href="#cb55-307" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb55-308"><a href="#cb55-308" aria-hidden="true" tabindex="-1"></a>flowchart TD</span>
<span id="cb55-309"><a href="#cb55-309" aria-hidden="true" tabindex="-1"></a>  X((Disease)) --&gt; A</span>
<span id="cb55-310"><a href="#cb55-310" aria-hidden="true" tabindex="-1"></a>  X --&gt; B</span>
<span id="cb55-311"><a href="#cb55-311" aria-hidden="true" tabindex="-1"></a>  X --&gt; C</span>
<span id="cb55-312"><a href="#cb55-312" aria-hidden="true" tabindex="-1"></a>  X --&gt; D</span>
<span id="cb55-313"><a href="#cb55-313" aria-hidden="true" tabindex="-1"></a>  C --&gt; B</span>
<span id="cb55-314"><a href="#cb55-314" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-315"><a href="#cb55-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-318"><a href="#cb55-318" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-319"><a href="#cb55-319" aria-hidden="true" tabindex="-1"></a>fit_fm_ld_direct <span class="ot">&lt;-</span> </span>
<span id="cb55-320"><a href="#cb55-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flexmix</span>(<span class="sc">~</span><span class="dv">1</span>, <span class="at">data =</span> uebersax_01, <span class="at">k =</span> <span class="dv">2</span>, </span>
<span id="cb55-321"><a href="#cb55-321" aria-hidden="true" tabindex="-1"></a>          <span class="at">weights =</span> <span class="sc">~</span>Freq,</span>
<span id="cb55-322"><a href="#cb55-322" aria-hidden="true" tabindex="-1"></a>          <span class="at">model =</span> <span class="fu">list</span>(</span>
<span id="cb55-323"><a href="#cb55-323" aria-hidden="true" tabindex="-1"></a>            <span class="fu">FLXMCmvbinary</span>(A <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb55-324"><a href="#cb55-324" aria-hidden="true" tabindex="-1"></a>            <span class="fu">FLXMRglmfix</span>(<span class="at">formula =</span> <span class="fu">cbind</span>(B, <span class="dv">1</span><span class="sc">-</span>B) <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb55-325"><a href="#cb55-325" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nested =</span> <span class="fu">list</span>(<span class="at">k =</span> <span class="dv">2</span>, <span class="at">formula =</span> <span class="sc">~</span> C),</span>
<span id="cb55-326"><a href="#cb55-326" aria-hidden="true" tabindex="-1"></a>                        <span class="at">family =</span> <span class="st">"binomial"</span>), </span>
<span id="cb55-327"><a href="#cb55-327" aria-hidden="true" tabindex="-1"></a>            <span class="fu">FLXMCmvbinary</span>(C <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb55-328"><a href="#cb55-328" aria-hidden="true" tabindex="-1"></a>            <span class="fu">FLXMCmvbinary</span>(D <span class="sc">~</span> <span class="dv">1</span>)))</span>
<span id="cb55-329"><a href="#cb55-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-330"><a href="#cb55-330" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_fm_ld_direct)</span>
<span id="cb55-331"><a href="#cb55-331" aria-hidden="true" tabindex="-1"></a><span class="fu">parameters</span>(fit_fm_ld_direct) <span class="sc">|&gt;</span> <span class="fu">lapply</span>(round, <span class="dv">4</span>)</span>
<span id="cb55-332"><a href="#cb55-332" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-333"><a href="#cb55-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-334"><a href="#cb55-334" aria-hidden="true" tabindex="-1"></a>We can again calculate a conditional probability in each class for B, this time by summing over values of C. Because the model is conditional on C, this time we weight by the marginal of C, i.e. $P(B | X) = \sum_C P(B | X, C) P(C)$.</span>
<span id="cb55-335"><a href="#cb55-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-338"><a href="#cb55-338" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-339"><a href="#cb55-339" aria-hidden="true" tabindex="-1"></a>P_B_given_XC <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_fm_ld_direct, </span>
<span id="cb55-340"><a href="#cb55-340" aria-hidden="true" tabindex="-1"></a>                        <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">C=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>))</span>
<span id="cb55-341"><a href="#cb55-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-342"><a href="#cb55-342" aria-hidden="true" tabindex="-1"></a>P_C <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(Freq<span class="sc">~</span>C, <span class="at">data =</span> uebersax_01) <span class="sc">|&gt;</span> <span class="fu">prop.table</span>()</span>
<span id="cb55-343"><a href="#cb55-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-344"><a href="#cb55-344" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">Comp.1.avg=</span><span class="fu">sum</span>(P_B_given_XC[[<span class="dv">1</span>]][, <span class="dv">2</span>] <span class="sc">*</span> P_C), </span>
<span id="cb55-345"><a href="#cb55-345" aria-hidden="true" tabindex="-1"></a>  <span class="at">Comp.2.avg=</span><span class="fu">sum</span>(P_B_given_XC[[<span class="dv">2</span>]][, <span class="dv">2</span>] <span class="sc">*</span> P_C))</span>
<span id="cb55-346"><a href="#cb55-346" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-347"><a href="#cb55-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-348"><a href="#cb55-348" aria-hidden="true" tabindex="-1"></a><span class="fu">### Loglinear formulation</span></span>
<span id="cb55-349"><a href="#cb55-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-350"><a href="#cb55-350" aria-hidden="true" tabindex="-1"></a>We can use the excellent <span class="in">`cvam`</span> package to create a loglinear latent class model. This allows for full flexibility, including the addition of local dependence parameters that do not require an arbitrary choice of "dependent" observed variable.</span>
<span id="cb55-351"><a href="#cb55-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-354"><a href="#cb55-354" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb55-355"><a href="#cb55-355" aria-hidden="true" tabindex="-1"></a>flowchart TD</span>
<span id="cb55-356"><a href="#cb55-356" aria-hidden="true" tabindex="-1"></a>  X((Disease)) --&gt; A</span>
<span id="cb55-357"><a href="#cb55-357" aria-hidden="true" tabindex="-1"></a>  X --&gt; B</span>
<span id="cb55-358"><a href="#cb55-358" aria-hidden="true" tabindex="-1"></a>  X --&gt; C</span>
<span id="cb55-359"><a href="#cb55-359" aria-hidden="true" tabindex="-1"></a>  X --&gt; D</span>
<span id="cb55-360"><a href="#cb55-360" aria-hidden="true" tabindex="-1"></a>  C &lt;--&gt; B</span>
<span id="cb55-361"><a href="#cb55-361" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-362"><a href="#cb55-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-363"><a href="#cb55-363" aria-hidden="true" tabindex="-1"></a>This is probably the best solution, if you can make it work. It only tends to work for smaller examples since <span class="in">`cvam`</span> has trouble with larger complete data cross-tables.</span>
<span id="cb55-364"><a href="#cb55-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-365"><a href="#cb55-365" aria-hidden="true" tabindex="-1"></a>It works great for the small <span class="in">`uebersax`</span> example.</span>
<span id="cb55-366"><a href="#cb55-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-369"><a href="#cb55-369" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-370"><a href="#cb55-370" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cvam)</span>
<span id="cb55-371"><a href="#cb55-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-372"><a href="#cb55-372" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="st">"contr.sum"</span>, <span class="st">"contr.linear"</span>))</span>
<span id="cb55-373"><a href="#cb55-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-374"><a href="#cb55-374" aria-hidden="true" tabindex="-1"></a>df_freq <span class="ot">&lt;-</span> uebersax <span class="sc">%&gt;%</span> <span class="fu">mutate_at</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, as.factor)</span>
<span id="cb55-375"><a href="#cb55-375" aria-hidden="true" tabindex="-1"></a>df_freq<span class="sc">$</span>X <span class="ot">&lt;-</span> <span class="fu">latentFactor</span>(<span class="fu">NROW</span>(df_freq), <span class="dv">2</span>)</span>
<span id="cb55-376"><a href="#cb55-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-377"><a href="#cb55-377" aria-hidden="true" tabindex="-1"></a>formula <span class="ot">&lt;-</span> </span>
<span id="cb55-378"><a href="#cb55-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">names</span>(df_freq)[<span class="sc">!</span><span class="fu">names</span>(df_freq) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Freq"</span>, <span class="st">"X"</span>)],</span>
<span id="cb55-379"><a href="#cb55-379" aria-hidden="true" tabindex="-1"></a>        <span class="at">collapse =</span> <span class="st">" + "</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-380"><a href="#cb55-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sprintf</span>(<span class="st">"~ X * (%s)"</span>, .) <span class="sc">%&gt;%</span></span>
<span id="cb55-381"><a href="#cb55-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.formula</span>()</span>
<span id="cb55-382"><a href="#cb55-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-383"><a href="#cb55-383" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(</span>
<span id="cb55-384"><a href="#cb55-384" aria-hidden="true" tabindex="-1"></a>  fit_cvam <span class="ot">&lt;-</span> <span class="fu">cvam</span>(formula, <span class="at">data =</span> df_freq,</span>
<span id="cb55-385"><a href="#cb55-385" aria-hidden="true" tabindex="-1"></a>                   <span class="at">freq =</span> Freq,</span>
<span id="cb55-386"><a href="#cb55-386" aria-hidden="true" tabindex="-1"></a>                   <span class="at">control =</span> <span class="fu">list</span>(<span class="at">startValJitter =</span> <span class="fl">0.1</span>)</span>
<span id="cb55-387"><a href="#cb55-387" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb55-388"><a href="#cb55-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-389"><a href="#cb55-389" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_cvam)</span>
<span id="cb55-390"><a href="#cb55-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-391"><a href="#cb55-391" aria-hidden="true" tabindex="-1"></a>what <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"~"</span>, LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="st">"|X"</span>) <span class="sc">|&gt;</span> <span class="fu">sapply</span>(as.formula)</span>
<span id="cb55-392"><a href="#cb55-392" aria-hidden="true" tabindex="-1"></a>est_indep <span class="ot">&lt;-</span> <span class="fu">cvamEstimate</span>(<span class="fu">c</span>(<span class="sc">~</span>X, what), fit_cvam)</span>
<span id="cb55-393"><a href="#cb55-393" aria-hidden="true" tabindex="-1"></a>est_indep</span>
<span id="cb55-394"><a href="#cb55-394" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-395"><a href="#cb55-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-396"><a href="#cb55-396" aria-hidden="true" tabindex="-1"></a>(Note that the Hessian-based se's cannot be trusted. We can look at the estimated se's in the marginal probability tables above, or use <span class="in">`cvam`</span>'s MCMC option to obtain standard errors on the loglinear parmeters.)</span>
<span id="cb55-397"><a href="#cb55-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-398"><a href="#cb55-398" aria-hidden="true" tabindex="-1"></a>Now we update the model with the local dependence $B \times C$, held equal across classes.</span>
<span id="cb55-399"><a href="#cb55-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-402"><a href="#cb55-402" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-403"><a href="#cb55-403" aria-hidden="true" tabindex="-1"></a>formula_ld <span class="ot">&lt;-</span> <span class="fu">update</span>(formula, <span class="sc">~</span> . <span class="sc">+</span> B<span class="sc">:</span>C)</span>
<span id="cb55-404"><a href="#cb55-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-405"><a href="#cb55-405" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(</span>
<span id="cb55-406"><a href="#cb55-406" aria-hidden="true" tabindex="-1"></a>  fit_cvam_ld <span class="ot">&lt;-</span> </span>
<span id="cb55-407"><a href="#cb55-407" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cvam</span>(formula_ld, <span class="at">data =</span> df_freq, <span class="at">freq =</span> Freq,</span>
<span id="cb55-408"><a href="#cb55-408" aria-hidden="true" tabindex="-1"></a>         <span class="at">control =</span> <span class="fu">list</span>(<span class="at">startValJitter =</span> <span class="fl">0.05</span>)</span>
<span id="cb55-409"><a href="#cb55-409" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb55-410"><a href="#cb55-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-411"><a href="#cb55-411" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_cvam_ld)</span>
<span id="cb55-412"><a href="#cb55-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-413"><a href="#cb55-413" aria-hidden="true" tabindex="-1"></a>est_locdep <span class="ot">&lt;-</span> <span class="fu">cvamEstimate</span>(<span class="fu">c</span>(<span class="sc">~</span>X, what), fit_cvam_ld)</span>
<span id="cb55-414"><a href="#cb55-414" aria-hidden="true" tabindex="-1"></a>est_locdep</span>
<span id="cb55-415"><a href="#cb55-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-416"><a href="#cb55-416" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_cvam, fit_cvam_ld)</span>
<span id="cb55-417"><a href="#cb55-417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-418"><a href="#cb55-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-419"><a href="#cb55-419" aria-hidden="true" tabindex="-1"></a>The local dependence model fits better, but the estimated (conditional) probabilities do not change much.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>